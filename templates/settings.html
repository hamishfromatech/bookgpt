{% extends "base.html" %}

{% block title %}Settings{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <div class="mb-10">
        <h1 class="font-display text-2xl font-medium text-slate-900 dark:text-white mb-1">Settings</h1>
        <p class="text-sm font-medium text-slate-500 dark:text-slate-400">Configure your AI writing assistant preferences</p>
    </div>

    <form id="settingsForm" onsubmit="return false;" class="space-y-6">
        <!-- LLM Configuration -->
        <section class="bg-surface-50 dark:bg-surface-900/50 rounded-2xl border border-surface-200 dark:border-white/5 overflow-hidden">
            <div class="px-6 py-5 border-b border-surface-200 dark:border-white/5">
                <h2 class="font-display text-lg font-medium text-slate-900 dark:text-white">LLM Configuration</h2>
                <p class="text-sm font-medium text-slate-500 dark:text-slate-400 mt-0.5">Configure your AI writing assistant settings</p>
            </div>
            <div class="p-6 space-y-5">
                <!-- Troubleshooting Info -->
                <div id="troubleshootingInfo" class="hidden p-4 bg-editorial-teal/5 dark:bg-editorial-teal/10 rounded-xl border border-editorial-teal/20">
                    <h4 class="text-xs font-semibold text-editorial-teal mb-2 flex items-center">
                        <svg class="w-4 h-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        Connection Help
                    </h4>
                    <div id="troubleshootingContent" class="text-xs text-slate-600 dark:text-slate-300 space-y-1"></div>
                </div>

                <div class="grid md:grid-cols-2 gap-5">
                    <div class="space-y-1.5">
                        <label for="llmProvider" class="block text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wider ml-1">Provider</label>
                        <select id="llmProvider" class="input-editorial w-full px-4 py-3 rounded-xl text-slate-900 dark:text-white font-medium outline-none">
                            <option value="openai">OpenAI</option>
                            <option value="ollama">Ollama</option>
                            <option value="lmstudio">LM Studio</option>
                            <option value="custom">Custom Endpoint</option>
                        </select>
                    </div>
                    <div class="space-y-1.5">
                        <label for="llmModel" class="block text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wider ml-1">Model Name</label>
                        <input type="text" id="llmModel" placeholder="gpt-4o" 
                            class="input-editorial w-full px-4 py-3 rounded-xl text-slate-900 dark:text-white font-medium outline-none">
                    </div>
                </div>

                <div class="space-y-1.5">
                    <label for="llmApiKey" class="block text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wider ml-1">API Key</label>
                    <input type="password" id="llmApiKey" autocomplete="off" placeholder="Enter your API key" 
                        class="input-editorial w-full px-4 py-3 rounded-xl text-slate-900 dark:text-white font-medium outline-none">
                </div>

                <div class="space-y-1.5">
                    <label for="llmBaseUrl" class="block text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wider ml-1">Base URL (Optional)</label>
                    <input type="url" id="llmBaseUrl" placeholder="https://api.openai.com/v1" 
                        class="input-editorial w-full px-4 py-3 rounded-xl text-slate-900 dark:text-white font-medium outline-none">
                </div>

                <div class="grid md:grid-cols-2 gap-5">
                    <div class="space-y-1.5">
                        <label for="llmTemperature" class="block text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wider ml-1">Temperature</label>
                        <input type="range" id="llmTemperature" min="0" max="1" step="0.1" value="0.7" 
                            class="w-full h-2 bg-surface-200 dark:bg-white/10 rounded-lg appearance-none cursor-pointer accent-accent">
                        <div class="flex justify-between text-[10px] text-slate-400 mt-2 font-semibold uppercase tracking-tight">
                            <span>Conservative</span>
                            <span id="temperatureValue" class="text-accent font-medium">0.7</span>
                            <span>Creative</span>
                        </div>
                    </div>
                    <div class="space-y-1.5">
                        <label for="llmMaxTokens" class="block text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wider ml-1">Max Tokens</label>
                        <input type="number" id="llmMaxTokens" min="1" step="1" value="4096" 
                            class="input-editorial w-full px-4 py-3 rounded-xl text-slate-900 dark:text-white font-medium outline-none">
                    </div>
                </div>

                <div class="pt-4 border-t border-surface-200 dark:border-white/5">
                    <h4 class="text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wider mb-3 ml-1">Quick Presets</h4>
                    <div class="flex flex-wrap gap-2">
                        <button onclick="applyPreset('openai')" class="px-3 py-1.5 text-xs font-medium rounded-lg bg-surface-100 dark:bg-white/5 hover:bg-surface-200 dark:hover:bg-white/10 transition-all">OpenAI</button>
                        <button onclick="applyPreset('ollama_llama3_2')" class="px-3 py-1.5 text-xs font-medium rounded-lg bg-surface-100 dark:bg-white/5 hover:bg-surface-200 dark:hover:bg-white/10 transition-all">Ollama</button>
                        <button onclick="applyPreset('llmstuido')" class="px-3 py-1.5 text-xs font-medium rounded-lg bg-surface-100 dark:bg-white/5 hover:bg-surface-200 dark:hover:bg-white/10 transition-all">LM Studio</button>
                    </div>
                </div>

                <div class="flex gap-3">
                    <button id="testConnectionBtn" class="flex-1 px-4 py-3 rounded-xl border border-surface-200 dark:border-white/10 text-slate-600 dark:text-slate-300 font-medium text-sm hover:bg-surface-100 dark:hover:bg-white/5 transition-all">
                        Test Connection
                    </button>
                    <button id="saveLLMBtn" class="flex-1 px-4 py-3 rounded-xl bg-slate-900 dark:bg-white text-white dark:text-slate-900 font-medium text-sm hover:opacity-90 transition-all">
                        Save Config
                    </button>
                </div>
                <div id="connectionStatus" class="hidden p-4 rounded-xl text-sm font-medium"></div>
            </div>
        </section>

        <!-- Writing Settings -->
        <section class="bg-surface-50 dark:bg-surface-900/50 rounded-2xl border border-surface-200 dark:border-white/5 overflow-hidden">
            <div class="px-6 py-5 border-b border-surface-200 dark:border-white/5">
                <h2 class="font-display text-lg font-medium text-slate-900 dark:text-white">Writing Settings</h2>
                <p class="text-sm font-medium text-slate-500 dark:text-slate-400 mt-0.5">Customize your book generation preferences</p>
            </div>
            <div class="p-6 space-y-5">
                <div class="grid md:grid-cols-2 gap-5">
                    <div class="space-y-1.5">
                        <label for="defaultTargetLength" class="block text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wider ml-1">Default Length</label>
                        <select id="defaultTargetLength" class="input-editorial w-full px-4 py-3 rounded-xl text-slate-900 dark:text-white font-medium outline-none">
                            <option value="30000">30,000 words</option>
                            <option value="50000">50,000 words</option>
                            <option value="80000">80,000 words</option>
                        </select>
                    </div>
                    <div class="space-y-1.5">
                        <label for="defaultGenre" class="block text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wider ml-1">Default Genre</label>
                        <select id="defaultGenre" class="input-editorial w-full px-4 py-3 rounded-xl text-slate-900 dark:text-white font-medium outline-none">
                            <option value="fiction">Fiction</option>
                            <option value="non_fiction">Non-Fiction</option>
                        </select>
                    </div>
                </div>

                <div class="flex items-center justify-between p-4 rounded-xl bg-surface-100 dark:bg-white/5">
                    <div>
                        <h4 class="text-sm font-medium text-slate-900 dark:text-white">Expert Mode</h4>
                        <p class="text-xs text-slate-500 dark:text-slate-400">Detailed logging and advanced debugging</p>
                    </div>
                    <input type="checkbox" id="expertMode" class="w-5 h-5 rounded border-slate-300 text-accent focus:ring-accent focus:ring-offset-0">
                </div>

                <button id="saveWritingBtn" class="w-full px-4 py-3 rounded-xl bg-slate-900 dark:bg-white text-white dark:text-slate-900 font-medium text-sm hover:opacity-90 transition-all">
                    Save Writing Settings
                </button>
            </div>
        </section>

        <!-- Danger Zone -->
        <section class="bg-red-50 dark:bg-red-900/10 rounded-2xl border border-red-100 dark:border-red-900/30 overflow-hidden">
            <div class="px-6 py-5 border-b border-red-100 dark:border-red-900/30">
                <h2 class="font-display text-lg font-medium text-red-900 dark:text-red-400">Danger Zone</h2>
                <p class="text-sm font-medium text-red-700 dark:text-red-500/70 mt-0.5">Irreversible actions</p>
            </div>
            <div class="p-6 space-y-4">
                <div class="flex items-center justify-between">
                    <div>
                        <h4 class="text-sm font-medium text-red-900 dark:text-red-400">Clear All Projects</h4>
                        <p class="text-xs text-red-700 dark:text-red-500/70">Delete all book projects permanently</p>
                    </div>
                    <button id="clearProjectsBtn" class="px-4 py-2 rounded-lg border border-red-200 dark:border-red-900/50 text-red-600 dark:text-red-400 font-medium text-xs hover:bg-red-100 dark:hover:bg-red-900/30 transition-all">
                        Clear Projects
                    </button>
                </div>
            </div>
        </section>
    </form>
</div>

<!-- Notification Container -->
<div id="notificationContainer" class="fixed top-4 right-4 z-50 space-y-2"></div>

<style>
    .input-editorial {
        transition: all 0.3s ease;
        background: rgba(235, 231, 222, 0.5);
    }
    
    .input-editorial:focus {
        background: rgba(235, 231, 222, 0.8);
        box-shadow: 0 0 0 3px rgba(232, 93, 76, 0.1);
    }

    .dark .input-editorial {
        background: rgba(255, 255, 255, 0.05);
    }

    .dark .input-editorial:focus {
        background: rgba(255, 255, 255, 0.1);
        box-shadow: 0 0 0 3px rgba(232, 93, 76, 0.2);
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        if (typeof loadSettingsIntoForm === 'function') {
            loadSettingsIntoForm();
        }
        if (typeof setupSettingsEventListeners === 'function') {
            setupSettingsEventListeners();
        }
    });
</script>
{% endblock %}